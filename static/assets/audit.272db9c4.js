import{_ as J,b as q,u as L,d as T,q as C,r as d,Q as P,a as g,R as H,e as U,o as D,f as $,g as E,j as e,k as a,z as B,h as b,y as W,m as _,S as z,E as I,n as R,W as Q,X,aE as G,aF as K,am as Z,A as ee,B as te,C as ae,as as oe,P as le,p as se,l as ne}from"./vendor.3587a8c4.js";const re={class:"box"},ie={class:"card"},de={key:0,style:{width:"60%",display:"flex","justify-content":"right"}},ue=_("\u6682\u5B58"),_e=_("\u63D0\u4EA4"),ce={props:["enableEdit","formData","formId"],setup(n){const s=n,w=q(),c=L(),h=T();let m=C({}),v=C({}),p=C({});const r=d(null);let y=w.query._id||s.formId;const S=h.state.userInfo;P(async()=>{m=(await g.get(`/form/${y}`)).data.struct,r.value.setFormJson(m),await H(()=>{s.enableEdit||r.value.disableForm(),s.formData&&!s.enableEdit&&r.value.setFormData(JSON.parse(s.formData)),s.enableEdit&&localStorage.getItem("formData")&&r.value.setFormData(JSON.parse(localStorage.getItem("formData")))})});const x=()=>{r.value.getFormData().then(i=>{let l=JSON.stringify(i);localStorage.setItem("formData",l)})},k=()=>{r.value.getFormData().then(i=>{let l=JSON.stringify(i),t=S._id,o=z().format("YYYY-MM-DD HH:mm:ss");g.post(`/data/${y}`,{create_time:o,user_id:t,data:l}).then(f=>{f.status!==200?I.error("\u63D0\u4EA4\u5931\u8D25\uFF01"):(I.success("\u63D0\u4EA4\u6210\u529F\uFF01"),c.push(`/user/${t}`))}),localStorage.removeItem("formData")}).catch(i=>{I.error(i)})};return(i,l)=>{const t=R,o=U("v-form-render");return D(),$("div",re,[E("div",ie,[s.enableEdit?(D(),$("span",de,[e(t,{onClick:x},{default:a(()=>[ue]),_:1})])):B("",!0),e(o,{"form-json":b(m),"form-data":b(v),"option-data":b(p),ref_key:"vFormRef",ref:r},null,8,["form-json","form-data","option-data"]),s.enableEdit?(D(),W(t,{key:1,type:"primary",style:{width:"200px"},onClick:k},{default:a(()=>[_e]),_:1})):B("",!0)])])}}};var me=J(ce,[["__scopeId","data-v-b26f7fe4"]]);function pe(){let n=JSON.parse(localStorage.getItem("user"));return g.get(`/audit/list/now/${n._id}`)}function fe(){let n=JSON.parse(localStorage.getItem("user"));return g.get(`/audit/list/history/${n._id}`)}function ve(n,s){return g.post(`/audit/${n}`,s)}const ge=n=>(se("data-v-0a942df0"),n=n(),ne(),n),be={class:"app-container"},he=_("\u5BA1\u6838"),ye=_("\u5BA1\u6279\u610F\u89C1"),xe={style:{display:"flex",width:"100%","justify-content":"center"}},De=ge(()=>E("br",null,null,-1)),Ee={style:{"text-align":"center"}},Ie=_("\u6E05\u7A7A"),we=_("\u901A\u8FC7"),Se=_("\u4E0D\u901A\u8FC7"),ke={setup(n){const s=d([]),w=d([]),c=d(!1),h=d(),m=d(),v=d(),p=d(""),r=d(),y=T(),S=l=>{r.value=l,h.value=l.data,m.value=l.form._id,c.value=!0};function x(){pe().then(l=>s.value=l.data),fe().then(l=>w.value=l.data)}const k=()=>{p.value="",v.value.reset()},i=l=>{v.value.generate().then(t=>{console.log(t),ve(r.value._id,{user_id:y.state.userInfo._id,index:r.value.audit_user_index,opinion:p.value,sign:t,result:l}).then(o=>{c.value=!1,I.success("\u5BA1\u6838\u6210\u529F"),x()})})};return x(),(l,t)=>{const o=Q,f=R,N=X,F=G,j=K,O=Z,A=ee,V=te,M=ae,Y=oe;return D(),$("div",be,[e(j,{"tab-position":"left"},{default:a(()=>[e(F,{label:"\u7B49\u5F85\u5BA1\u6279"},{default:a(()=>[e(N,{data:s.value},{default:a(()=>[e(o,{type:"index",align:"center"}),e(o,{label:"\u4E1A\u52A1\u540D\u79F0",align:"center",prop:"form.name"}),e(o,{label:"\u586B\u5199\u4EBA",align:"center",prop:"user.name"}),e(o,{label:"\u586B\u5199\u8005\u90E8\u95E8",align:"center",prop:"user.deptName"}),e(o,{label:"\u586B\u5199\u65F6\u95F4",align:"center",prop:"create_time",width:"180"}),e(o,{label:"\u64CD\u4F5C",align:"center","class-name":"small-padding fixed-width"},{default:a(u=>[e(f,{type:"text",icon:"View",onClick:Ce=>S(u.row)},{default:a(()=>[he]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])]),_:1}),e(F,{label:"\u5BA1\u6279\u5386\u53F2"},{default:a(()=>[e(N,{data:s.value},{default:a(()=>[e(o,{type:"index",align:"center"}),e(o,{label:"\u4E1A\u52A1\u540D\u79F0",align:"center",prop:"form.name"}),e(o,{label:"\u586B\u5199\u4EBA",align:"center",prop:"user.name"}),e(o,{label:"\u586B\u5199\u8005\u90E8\u95E8",align:"center",prop:"user.deptName"}),e(o,{label:"\u586B\u5199\u65F6\u95F4",align:"center",prop:"create_time",width:"180"})]),_:1},8,["data"])]),_:1})]),_:1}),e(Y,{top:"5vh",title:"\u5BA1\u6838",modelValue:c.value,"onUpdate:modelValue":t[3]||(t[3]=u=>c.value=u),width:"80vw"},{default:a(()=>[e(b(me),{"form-id":m.value,"enable-edit":!1,"form-data":h.value},null,8,["form-id","form-data"]),e(O,null,{default:a(()=>[ye]),_:1}),E("span",xe,[e(M,{style:{width:"30vw",border:"1px dashed gray",padding:"20px"}},{default:a(()=>[e(V,{label:"\u610F\u89C1"},{default:a(()=>[e(A,{modelValue:p.value,"onUpdate:modelValue":t[0]||(t[0]=u=>p.value=u)},null,8,["modelValue"])]),_:1}),e(V,{required:"",label:"\u7B7E\u540D"},{default:a(()=>[e(b(le),{ref_key:"sign",ref:v,isClearBgColor:!1,bgColor:"#eceef1",width:300,height:150,isCrop:!1,lineWidth:6,lineColor:"#000000"},null,512)]),_:1})]),_:1})]),De,E("div",Ee,[e(f,{type:"info",onClick:k},{default:a(()=>[Ie]),_:1}),e(f,{type:"success",onClick:t[1]||(t[1]=u=>i(!0))},{default:a(()=>[we]),_:1}),e(f,{type:"danger",onClick:t[2]||(t[2]=u=>i(!1))},{default:a(()=>[Se]),_:1})])]),_:1},8,["modelValue"])])}}};var Ne=J(ke,[["__scopeId","data-v-0a942df0"]]);export{Ne as default};
