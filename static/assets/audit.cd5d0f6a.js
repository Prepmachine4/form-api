import{_ as J,b as L,u as P,d as T,q as F,r as d,Q as H,a as v,R as U,e as W,o as b,f as N,g as E,j as e,k as o,z as V,h as x,y as O,m as u,S as z,E as g,n as R,W as Q,X,aE as G,aF as K,am as Z,A as ee,B as te,C as ae,as as oe,P as se,p as le,l as ne}from"./vendor.3587a8c4.js";const re={class:"box"},ie={class:"card"},de={key:0,style:{width:"60%",display:"flex","justify-content":"right"}},ue=u("\u6682\u5B58"),ce=u("\u4FEE\u6539"),_e=u("\u63D0\u4EA4"),me={props:{enableEdit:{type:Boolean,default:!0},formData:String,formId:String,formDataId:String,change:{type:Boolean,default:!1}},setup(n){const s=n,D=L(),_=P(),I=T();let m=F({}),h=F({}),p=F({});const r=d(null),S=d();let k=D.query._id||s.formId;const y=I.state.userInfo;H(async()=>{S.value=(await v.get(`/form/${k}`)).data,m=S.value.struct,r.value.setFormJson(m),await U(()=>{localStorage.getItem("formData")?r.value.setFormData(JSON.parse(localStorage.getItem("formData"))):s.formData&&r.value.setFormData(JSON.parse(s.formData)),s.change||r.value.disableForm()})});const $=()=>{r.value.getFormData().then(t=>{let a=JSON.stringify(t);localStorage.setItem("formData",a)})},w=()=>{r.value.getFormData().then(t=>{let a=JSON.stringify(t),l=y._id,f=z().format("YYYY-MM-DD HH:mm:ss");v.post(`/data/${k}`,{create_time:f,user_id:l,data:a}).then(C=>{C.status!==200?g.error("\u63D0\u4EA4\u5931\u8D25\uFF01"):(g.success("\u63D0\u4EA4\u6210\u529F\uFF01"),_.push(`/user/${l}`))}),localStorage.removeItem("formData")}).catch(t=>{g.error(t)})},i=()=>{r.value.getFormData().then(t=>{let a=JSON.stringify(t);y._id,console.log(s),v.put(`/data/${s.formDataId}`,{data:a}).then(l=>{l.status!==200?g.error("\u63D0\u4EA4\u5931\u8D25\uFF01"):g.success("\u63D0\u4EA4\u6210\u529F\uFF01")})})};return(t,a)=>{const l=R,f=W("v-form-render");return b(),N("div",re,[E("div",ie,[s.enableEdit?(b(),N("span",de,[e(l,{onClick:$},{default:o(()=>[ue]),_:1})])):V("",!0),e(f,{"form-json":x(m),"form-data":x(h),"option-data":x(p),ref_key:"vFormRef",ref:r},null,8,["form-json","form-data","option-data"]),s.change?(b(),O(l,{key:1,type:"primary",style:{width:"200px"},onClick:i},{default:o(()=>[ce]),_:1})):V("",!0),s.enableEdit?(b(),O(l,{key:2,type:"primary",style:{width:"200px"},onClick:w},{default:o(()=>[_e]),_:1})):V("",!0)])])}}};var pe=J(me,[["__scopeId","data-v-e8d31030"]]);function fe(){let n=JSON.parse(localStorage.getItem("user"));return v.get(`/audit/list/now/${n._id}`)}function ve(){let n=JSON.parse(localStorage.getItem("user"));return v.get(`/audit/list/history/${n._id}`)}function ge(n,s){return v.post(`/audit/${n}`,s)}const he=n=>(le("data-v-514e57e4"),n=n(),ne(),n),ye={class:"app-container"},be=u("\u5BA1\u6838"),xe=u("\u5BA1\u6279\u610F\u89C1"),De={style:{display:"flex",width:"100%","justify-content":"center"}},Ie=he(()=>E("br",null,null,-1)),Se={style:{"text-align":"center"}},ke=u("\u6E05\u7A7A"),we=u("\u901A\u8FC7"),Ce=u("\u4E0D\u901A\u8FC7"),Ee={setup(n){const s=d([]),D=d([]),_=d(!1),I=d(),m=d(),h=d(),p=d(""),r=d(),S=T(),k=i=>{r.value=i,I.value=i.data,m.value=i.form._id,_.value=!0};function y(){fe().then(i=>s.value=i.data),ve().then(i=>D.value=i.data)}const $=()=>{p.value="",h.value.reset()},w=i=>{h.value.generate().then(t=>{console.log(t),ge(r.value._id,{user_id:S.state.userInfo._id,index:r.value.audit_user_index,opinion:p.value,sign:t,result:i}).then(a=>{_.value=!1,g.success("\u5BA1\u6838\u6210\u529F"),y()})})};return y(),(i,t)=>{const a=Q,l=R,f=X,C=G,j=K,A=Z,M=ee,B=te,Y=ae,q=oe;return b(),N("div",ye,[e(j,{"tab-position":"left"},{default:o(()=>[e(C,{label:"\u7B49\u5F85\u5BA1\u6279"},{default:o(()=>[e(f,{data:s.value},{default:o(()=>[e(a,{type:"index",align:"center"}),e(a,{label:"\u4E1A\u52A1\u540D\u79F0",align:"center",prop:"form.name"}),e(a,{label:"\u586B\u5199\u4EBA",align:"center",prop:"user.name"}),e(a,{label:"\u586B\u5199\u8005\u90E8\u95E8",align:"center",prop:"user.deptName"}),e(a,{label:"\u586B\u5199\u65F6\u95F4",align:"center",prop:"create_time",width:"180"}),e(a,{label:"\u64CD\u4F5C",align:"center","class-name":"small-padding fixed-width"},{default:o(c=>[e(l,{type:"text",icon:"View",onClick:$e=>k(c.row)},{default:o(()=>[be]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])]),_:1}),e(C,{label:"\u5BA1\u6279\u5386\u53F2"},{default:o(()=>[e(f,{data:D.value},{default:o(()=>[e(a,{type:"index",align:"center"}),e(a,{label:"\u4E1A\u52A1\u540D\u79F0",align:"center",prop:"form.name"}),e(a,{label:"\u586B\u5199\u4EBA",align:"center",prop:"user.name"}),e(a,{label:"\u586B\u5199\u8005\u90E8\u95E8",align:"center",prop:"user.deptName"}),e(a,{label:"\u586B\u5199\u65F6\u95F4",align:"center",prop:"create_time",width:"180"})]),_:1},8,["data"])]),_:1})]),_:1}),e(q,{top:"5vh",title:"\u5BA1\u6838",modelValue:_.value,"onUpdate:modelValue":t[3]||(t[3]=c=>_.value=c),width:"80vw"},{default:o(()=>[e(x(pe),{"form-id":m.value,"enable-edit":!1,"form-data":I.value},null,8,["form-id","form-data"]),e(A,null,{default:o(()=>[xe]),_:1}),E("span",De,[e(Y,{style:{width:"30vw",border:"1px dashed gray",padding:"20px"}},{default:o(()=>[e(B,{label:"\u610F\u89C1"},{default:o(()=>[e(M,{modelValue:p.value,"onUpdate:modelValue":t[0]||(t[0]=c=>p.value=c)},null,8,["modelValue"])]),_:1}),e(B,{required:"",label:"\u7B7E\u540D"},{default:o(()=>[e(x(se),{ref_key:"sign",ref:h,isClearBgColor:!1,bgColor:"#eceef1",width:300,height:150,isCrop:!1,lineWidth:6,lineColor:"#000000"},null,512)]),_:1})]),_:1})]),Ie,E("div",Se,[e(l,{type:"info",onClick:$},{default:o(()=>[ke]),_:1}),e(l,{type:"success",onClick:t[1]||(t[1]=c=>w(!0))},{default:o(()=>[we]),_:1}),e(l,{type:"danger",onClick:t[2]||(t[2]=c=>w(!1))},{default:o(()=>[Ce]),_:1})])]),_:1},8,["modelValue"])])}}};var Ne=J(Ee,[["__scopeId","data-v-514e57e4"]]);export{Ne as default};
